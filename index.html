<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å¤§å®®è‹¥èœç”º ç”ºå†…ä¼šãƒãƒ¼ã‚¿ãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background-color: #f8f8f8;
    }
    h1 {
      color: #2c3e50;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      margin-right: 1rem;
    }
    #status {
      margin: 1rem 0;
      font-weight: bold;
    }
    .section {
      margin-top: 2rem;
      padding: 1rem;
      border: 1px solid #ccc;
      background: #fff;
    }
  </style>
</head>
<body>

  <h1>å¤§å®®è‹¥èœç”º ç”ºå†…ä¼šãƒãƒ¼ã‚¿ãƒ«</h1>

  <button id="loginBtn">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
  <button id="logoutBtn" style="display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  <div id="status">ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèªä¸­...</div>

  <!-- â†“â†“â†“ è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆå¯¾è±¡ãƒ–ãƒ­ãƒƒã‚¯ â†“â†“â†“ -->

  <div id="adminContent" class="section" style="display:none;">
    <h2>ç®¡ç†è€…å‘ã‘æ©Ÿèƒ½</h2>
    <ul>
      <li>ä¼šå“¡åç°¿ã®ç·¨é›†</li>
      <li>äºˆç®—ã®ç™»éŒ²ãƒ»å¤‰æ›´</li>
      <li>å…¨ä½“è¨­å®šã®å¤‰æ›´</li>
    </ul>
  </div>

  <div id="officerContent" class="section" style="display:none;">
    <h2>å½¹å“¡å‘ã‘æ©Ÿèƒ½</h2>
    <ul>
      <li>è¡Œäº‹ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã®ç™»éŒ²</li>
      <li>é…å¸ƒç‰©ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</li>
    </ul>
  </div>

  <div id="generalContent" class="section" style="display:none;">
    <h2>ä¸€èˆ¬ä¼šå“¡å‘ã‘ãƒšãƒ¼ã‚¸</h2>
    <p>ãŠçŸ¥ã‚‰ã›ãƒ»è¡Œäº‹äºˆå®šã®é–²è¦§ã€ç”³ã—è¾¼ã¿ ãªã©</p>
  </div>

  <!-- Firebase åˆæœŸåŒ–ï¼†å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    // ğŸ”‘ Firebaseè¨­å®šï¼ˆã‚ãªãŸã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ã«ä¿®æ­£ï¼‰
    const firebaseConfig = {
      apiKey: "AIzaSyAn-XGz8iAtjxuN39SheOaF9nQf2LuCYYM",
      authDomain: "wakana-town-site.firebaseapp.com",
      projectId: "wakana-town-site",
      storageBucket: "wakana-town-site.firebasestorage.app",
      messagingSenderId: "939136744820",
      appId: "1:939136744820:web:2e9ba9eb77288a684a4021",
      measurementId: "G-Z6VWWHKPFV"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOMå–å¾—
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const statusDiv = document.getElementById("status");

    const adminContent = document.getElementById("adminContent");
    const officerContent = document.getElementById("officerContent");
    const generalContent = document.getElementById("generalContent");

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    loginBtn.addEventListener("click", () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then(result => {
          console.log("âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ:", result.user);
        })
        .catch(error => {
          console.error("âŒ ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:", error);
          alert(error.message);
        });
    });

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
    logoutBtn.addEventListener("click", () => {
      firebase.auth().signOut().then(() => {
        console.log("âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ");
      });
    });

    // èªè¨¼çŠ¶æ…‹ã®å¤‰åŒ–
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        statusDiv.textContent = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š${user.displayName}ï¼ˆ${user.email}ï¼‰`;

        // Firestoreã«ç™»éŒ² or å–å¾—
        const userRef = db.collection("users").doc(user.uid);
        userRef.get().then(doc => {
          if (!doc.exists) {
            // åˆå›ãƒ­ã‚°ã‚¤ãƒ³ï¼šç™»éŒ²
            userRef.set({
              uid: user.uid,
              email: user.email,
              name: user.displayName || "æœªè¨­å®š",
              role: "ä¸€èˆ¬",
              joinedAt: new Date().toISOString()
            }).then(() => {
              console.log("âœ… Firestoreã«ç™»éŒ²ã—ã¾ã—ãŸ");
              showContentByRole("ä¸€èˆ¬");
            });
          } else {
            const role = doc.data().role || "ä¸€èˆ¬";
            showContentByRole(role);
            console.log(`âœ… Firestoreãƒ­ãƒ¼ãƒ« = ${role}`);
          }
        });
      } else {
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        statusDiv.textContent = "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚";
        hideAllRoles();
      }
    });

    // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆé–¢æ•°
    function showContentByRole(role) {
      hideAllRoles();
      if (role === "ç®¡ç†è€…") adminContent.style.display = "block";
      if (role === "å½¹å“¡" || role === "ç®¡ç†è€…") officerContent.style.display = "block";
      generalContent.style.display = "block";
    }

    function hideAllRoles() {
      adminContent.style.display = "none";
      officerContent.style.display = "none";
      generalContent.style.display = "none";
    }
  </script>

</body>
</html>
